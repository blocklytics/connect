type Vote @entity {
  id: ID!
  org: LiquidDemocracy!
  department: Department!
  creator: DepartmentMember!
  metadata: String!
  executed: Boolean!
  startDate: BigInt!
  snapshotBlock: BigInt!
  supportRequiredPct: BigInt!
  minAcceptQuorum: BigInt!
  yea: BigInt!
  nay: BigInt!
  votingPower: BigInt!
  script: Bytes!
  voteNum: BigInt!
  numCasts: BigInt!
  casts: [Cast!]! @derivedFrom(field: "vote")
}

type Cast @entity {
  id: ID!
  vote: Vote!
  voteNum: BigInt!
  voter: DepartmentMember!
  supports: Boolean!
  voterStake: BigInt!
}

type LiquidDemocracy @entity {
  id: ID!                              # orgAddress
  departments: [Department]! @derivedFrom(field: "org")
  tokens: [Token]! @derivedFrom(field: "org")
  tokenManagers: [TokenManager]! @derivedFrom(field: "org")
}

type Token @entity {
  id: ID! # Address
  name: String!
  decimals: BigInt!
  symbol: String!
  totalSupply: BigInt!
  department: Department!
  org: LiquidDemocracy!
  tokenManager: TokenManager! @derivedFrom(field: "token")
}

type Department @entity {
  id: ID!
  name: String!
  org: LiquidDemocracy!
  appId: String!
  token: Token!
  supportRequiredPct: BigInt!
  minAcceptQuorum: BigInt!
  voteDuration: BigInt!
  votes: [Vote]! @derivedFrom(field: "department")
  members: [DepartmentMember]!
  isManagement: Boolean!
  tokenManager: TokenManager! @derivedFrom(field: "department")
}

type TokenManager @entity {
  id: ID!
  department: Department!
  org: LiquidDemocracy!
  token: Token!
}

type User @entity {
  id: ID! # Ethereum address
  orgs: [LiquidDemocracy]!
  departments: [DepartmentMember]! @derivedFrom(field: "user")
  currentDelegatedFrom: [DelegationBalance]! @derivedFrom(field: "fromUser")
  currentDelegatedTo: [DelegationBalance]! @derivedFrom(field: "toUser")
  delegatedFromHistory: [DelegationHistory]! @derivedFrom(field: "fromUser")
  delegatedToHistory: [DelegationHistory]! @derivedFrom(field: "toUser")
}

type DepartmentMember @entity {
  id: ID! # appAddress + "-" + Ethereum address
  user: User!
  department: Department!
  votingPower: BigInt!
  votingPowerPercent: BigDecimal!
  currentTokenBalance: BigInt!
  currentAmountDelegatedFrom: BigInt!
  currentAmountDelegatedTo: BigInt!
  votesCast: [Cast]! @derivedFrom(field: "voter")
  currentDelegatedFrom: [DelegationBalance]! @derivedFrom(field: "fromMember")
  currentDelegatedTo: [DelegationBalance]! @derivedFrom(field: "toMember")
  delegatedFromHistory: [DelegationHistory]! @derivedFrom(field: "fromMember")
  delegatedToHistory: [DelegationHistory]! @derivedFrom(field: "toMember")
}

type DelegationBalance @entity {
  id: ID!                                 # department-from-to
  department: Department!
  fromUser: User!
  toUser: User!
  fromMember: DepartmentMember!
  toMember: DepartmentMember!
  currentBalance: BigInt!
}

type DelegationHistory @entity {
  id: ID!                                 # department-from-to-block-logIndex
  department: Department!
  fromUser: User!
  toUser: User!
  fromMember: DepartmentMember!
  toMember: DepartmentMember!
  amount: BigInt!                         # Negative values = UnDelegation
  newBalance: BigInt!
  blockNumber: BigInt!
  transactionLogIndex: BigInt!
  timestamp: BigInt!
  transaction: Bytes!
}

type AragonInfo @entity {
  id: ID!
  orgs: [Bytes!]!
  apps: [Bytes!]!
  tokens: [Bytes!]!
}
